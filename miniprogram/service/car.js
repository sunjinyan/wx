"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CarService = void 0;
const camelcaseKeys = require("camelcase-keys");
const car_pb_1 = require("./proto_gen/car/car_pb");
const request_1 = require("./request");
var CarService;
(function (CarService) {
    function subscribe(onMsg) {
        let socket = wx.connectSocket({
            url: request_1.Coolcar.wsAddr + "/ws"
        });
        if (socket == undefined) {
            return;
        }
        socket.onMessage(msg => {
            const obj = JSON.parse(msg.data);
            onMsg(car_pb_1.car.v1.CarEntity.fromObject(camelcaseKeys(obj, {
                deep: true
            })));
        });
        return socket;
    }
    CarService.subscribe = subscribe;
    function getCar(id) {
        return request_1.Coolcar.sendRequestWithAuthRetry({
            method: 'GET',
            path: `/v1/car/${encodeURIComponent(id)}`,
            respMarshaller: car_pb_1.car.v1.Car.fromObject
        });
    }
    CarService.getCar = getCar;
})(CarService = exports.CarService || (exports.CarService = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY2FyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGdEQUFpRDtBQUNqRCxtREFBNkM7QUFDN0MsdUNBQW9DO0FBRXBDLElBQWlCLFVBQVUsQ0EwQzFCO0FBMUNELFdBQWlCLFVBQVU7SUFDdkIsU0FBZ0IsU0FBUyxDQUFDLEtBQWlDO1FBQ3ZELElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQyxhQUFhLENBQUM7WUFDMUIsR0FBRyxFQUFDLGlCQUFPLENBQUMsTUFBTSxHQUFHLEtBQUs7U0FDN0IsQ0FBQyxDQUFBO1FBVUYsSUFBSSxNQUFNLElBQUksU0FBUyxFQUFFO1lBQ3JCLE9BQU07U0FDVDtRQUNELE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDbkIsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBYyxDQUFDLENBQUE7WUFFMUMsS0FBSyxDQUFDLFlBQUcsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FDN0IsYUFBYSxDQUFDLEdBQUcsRUFBQztnQkFDZCxJQUFJLEVBQUMsSUFBSTthQUNaLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDWixDQUFDLENBQUMsQ0FBQTtRQUVGLE9BQU8sTUFBTSxDQUFBO0lBQ2pCLENBQUM7SUExQmUsb0JBQVMsWUEwQnhCLENBQUE7SUFHRCxTQUFnQixNQUFNLENBQUMsRUFBUztRQUs1QixPQUFRLGlCQUFPLENBQUMsd0JBQXdCLENBQUM7WUFDckMsTUFBTSxFQUFFLEtBQUs7WUFDYixJQUFJLEVBQUMsV0FBVyxrQkFBa0IsQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUN4QyxjQUFjLEVBQUMsWUFBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsVUFBVTtTQUN2QyxDQUFDLENBQUE7SUFDTixDQUFDO0lBVmUsaUJBQU0sU0FVckIsQ0FBQTtBQUVMLENBQUMsRUExQ2dCLFVBQVUsR0FBVixrQkFBVSxLQUFWLGtCQUFVLFFBMEMxQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjYW1lbGNhc2VLZXlzID0gcmVxdWlyZShcImNhbWVsY2FzZS1rZXlzXCIpO1xyXG5pbXBvcnQgeyBjYXIgfSBmcm9tIFwiLi9wcm90b19nZW4vY2FyL2Nhcl9wYlwiO1xyXG5pbXBvcnQgeyBDb29sY2FyIH0gZnJvbSBcIi4vcmVxdWVzdFwiO1xyXG5cclxuZXhwb3J0IG5hbWVzcGFjZSBDYXJTZXJ2aWNlIHtcclxuICAgIGV4cG9ydCBmdW5jdGlvbiBzdWJzY3JpYmUob25Nc2c6KGM6Y2FyLnYxLklDYXJFbnRpdHkpPT52b2lkKSB7XHJcbiAgICAgICAgbGV0IHNvY2tldCA9IHd4LmNvbm5lY3RTb2NrZXQoe1xyXG4gICAgICAgICAgICB1cmw6Q29vbGNhci53c0FkZHIgKyBcIi93c1wiXHJcbiAgICAgICAgfSlcclxuICAgICAgICAvLyBsZXQgaW50ZXJ2YWwgPSAgdW5kZWZpbmVkXHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gaWYgKCFzb2NrZXQpIHtcclxuICAgICAgICAvLyAgICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKT0+e1xyXG4gICAgICAgIC8vICAgICAgICAgc29ja2V0ID0gd3guY29ubmVjdFNvY2tldCh7XHJcbiAgICAgICAgLy8gICAgICAgICAgICAgdXJsOkNvb2xjYXIud3NBZGRyICsgXCIvd3NcIlxyXG4gICAgICAgIC8vICAgICAgICAgfSlcclxuICAgICAgICAvLyAgICAgfSwxMDAwKVxyXG4gICAgICAgIC8vIH1cclxuICAgICAgICBpZiAoc29ja2V0ID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm5cclxuICAgICAgICB9XHJcbiAgICAgICAgc29ja2V0Lm9uTWVzc2FnZShtc2cgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBvYmogPSBKU09OLnBhcnNlKG1zZy5kYXRhIGFzIHN0cmluZylcclxuXHJcbiAgICAgICAgICAgIG9uTXNnKGNhci52MS5DYXJFbnRpdHkuZnJvbU9iamVjdChcclxuICAgICAgICAgICAgICAgIGNhbWVsY2FzZUtleXMob2JqLHtcclxuICAgICAgICAgICAgICAgICAgICBkZWVwOnRydWVcclxuICAgICAgICAgICAgICAgIH0pKSlcclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICByZXR1cm4gc29ja2V0XHJcbiAgICB9XHJcblxyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiBnZXRDYXIoaWQ6c3RyaW5nKTpQcm9taXNlPGNhci52MS5JQ2FyPiB7XHJcbiAgICAgICAgLy8gcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLHJlamVjdCk9PntcclxuXHJcbiAgICAgICAgLy8gfSlcclxuXHJcbiAgICAgICAgcmV0dXJuICBDb29sY2FyLnNlbmRSZXF1ZXN0V2l0aEF1dGhSZXRyeSh7XHJcbiAgICAgICAgICAgIG1ldGhvZCA6J0dFVCcsXHJcbiAgICAgICAgICAgIHBhdGg6YC92MS9jYXIvJHtlbmNvZGVVUklDb21wb25lbnQoaWQpfWAsXHJcbiAgICAgICAgICAgIHJlc3BNYXJzaGFsbGVyOmNhci52MS5DYXIuZnJvbU9iamVjdFxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG59Il19